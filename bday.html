<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title id="page-title">ƒ∞yi ki Doƒüdun</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for background music -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* Base Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            -webkit-overflow-scrolling: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
            transition: background-color 1s ease-in-out, background-image 1s ease-in-out;
            box-sizing: border-box;
        }

        @media (max-width: 640px) {
            body {
                padding: 10px;
            }
            
            /* Mobilde daha fazla bo≈üluk */
            #game-container > * {
                margin-bottom: 1rem;
            }
        }

        /* --- TEMA RENKLERƒ∞ VE PASTA STƒ∞Lƒ∞ (ƒ∞LK ≈ûIK VERSƒ∞YON) --- */
        
        /* Kƒ±≈ü Temasƒ± (Noel Pazarƒ± ve Karlƒ± Gece) */
        body.theme-winter { 
            background-color: #0f172a;
            background-image:
                /* Zemin (Kar) */
                radial-gradient(ellipse at 50% 100%, #e2e8f0 0%, #94a3b8 40%, transparent 40.1%),
                
                /* Noel Baba ve Geyikler (Ayƒ±n √∂n√ºnde sil√ºet) */
                radial-gradient(circle at 15% 20%, #fff 10%, transparent 10.2%), /* Ay */
                /* Sil√ºetler (Basit daireler/elipsler ile) */
                radial-gradient(ellipse at 15% 20%, #0f172a 2%, transparent 2.2%), /* Kƒ±zak */
                radial-gradient(circle at 12% 21%, #0f172a 0.5%, transparent 0.6%), /* Geyik 1 */
                radial-gradient(circle at 10% 22%, #0f172a 0.5%, transparent 0.6%), /* Geyik 2 */
                
                /* √áam Aƒüa√ßlarƒ± (Arka Plan) */
                conic-gradient(from 150deg at 80% 60%, transparent 0deg, #064e3b 1deg, #064e3b 60deg, transparent 61deg),
                conic-gradient(from 150deg at 90% 65%, transparent 0deg, #065f46 1deg, #065f46 60deg, transparent 61deg),
                
                /* G√∂ky√ºz√º */
                linear-gradient(to bottom, #020617 0%, #1e293b 100%);
            
            background-size: 
                100% 100%, /* Zemin */
                100% 100%, /* Ay */
                100% 100%, /* Kƒ±zak */
                100% 100%, /* Geyik 1 */
                100% 100%, /* Geyik 2 */
                100% 100%, /* Aƒüa√ß 1 */
                100% 100%, /* Aƒüa√ß 2 */
                100% 100%; /* G√∂ky√ºz√º */
            background-position: 
                0 0, 
                0 0, 0 0, 0 0, 0 0, 0 0, 0 0, 0 0;
            background-repeat: no-repeat;
        }

        .theme-winter .candle-body { background: linear-gradient(to top, #F59E0B, #eab308); } /* Altƒ±n Mum */
        .theme-winter .cake-icing-color { background-color: #B91C1C; } /* Kƒ±rmƒ±zƒ± Krema */
        
        /* ƒ∞lkbahar Temasƒ± (Masmavi G√∂ky√ºz√º ve Bulutlar) */
        body.theme-spring { 
            background-color: #60A5FA; 
            background-image:
                /* Bulutlar (Yumu≈üak ve Daƒüƒ±nƒ±k) */
                radial-gradient(circle at 15% 15%, rgba(255,255,255,0.9) 0%, transparent 15%),
                radial-gradient(circle at 25% 20%, rgba(255,255,255,0.7) 0%, transparent 12%),
                radial-gradient(circle at 60% 10%, rgba(255,255,255,0.8) 0%, transparent 18%),
                radial-gradient(circle at 85% 25%, rgba(255,255,255,0.9) 0%, transparent 15%),
                /* G√∂ky√ºz√º Gradyanƒ± (Derin Mavi -> A√ßƒ±k Mavi) */
                linear-gradient(to bottom, #2563EB 0%, #93C5FD 100%);
            background-size: 100% 100%;
            background-attachment: fixed;
        }
        .theme-spring .candle-body { background: linear-gradient(to top, #FEF08A, #FDE68A); }
        .theme-spring .cake-icing-color { background-color: #34D399; } /* Bahar Ye≈üili Krema */
        
        /* Yaz Temasƒ± (Kumsal Zeminli) */
        body.theme-summer {
            background-color: #87CEEB; /* A√ßƒ±k Mavi G√∂ky√ºz√º */
            background-image: 
                /* G√ºne≈ü */
                radial-gradient(circle at 20% 20%, #FDB813 0%, #FDB813 12%, rgba(253, 184, 19, 0.5) 18%, transparent 20%),
                
                /* Bulutlar */
                radial-gradient(circle at 70% 15%, rgba(255,255,255,0.8) 0%, transparent 10%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.6) 0%, transparent 8%),

                /* Kum (En Alt 120px - Boydan Boya) */
                linear-gradient(to top, #F4A460 0%, #e6c288 120px, transparent 120px),

                /* Deniz (Kumun arkasƒ±nda) */
                linear-gradient(to top, #006994 0%, #0077be 300px, transparent 300px);
            
            background-size: 100% 100%;
            background-position: 0 0;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .theme-summer .candle-body { background: linear-gradient(to top, #FF7F50, #FF6347); }
        .theme-summer .cake-icing-color { background-color: #FF5733; } /* Turuncu/Kƒ±zƒ±l Krema */

        /* Sonbahar Temasƒ± (H√ºz√ºnl√º ve Yoƒüun) */
        body.theme-autumn { 
            background-color: #2d2424; 
            background-image:
                /* Islak Zemin Yansƒ±masƒ± */
                linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 25%),
                
                /* √áƒ±plak Aƒüa√ßlar (Sil√ºetler) */
                conic-gradient(from 175deg at 10% 100%, #1a1212 0deg, #1a1212 10deg, transparent 10.1deg, transparent 350deg, #1a1212 350deg),
                conic-gradient(from 175deg at 90% 100%, #1a1212 0deg, #1a1212 10deg, transparent 10.1deg, transparent 350deg, #1a1212 350deg),
                
                /* Sis ve Pus */
                linear-gradient(to top, rgba(100, 100, 100, 0.1) 0%, transparent 50%),
                
                /* Kasvetli G√∂ky√ºz√º (G√ºn Batƒ±mƒ± Sonrasƒ±) */
                linear-gradient(to bottom, #1f1a1d 0%, #3d2e33 50%, #5c4033 100%);
            background-size: 100% 100%;
            background-attachment: fixed;
        }
        .theme-autumn .candle-body { background: linear-gradient(to top, #5D4037, #3E2723); } /* Koyu Kahve Mum */
        .theme-autumn .cake-icing-color { background-color: #8D6E63; } /* Soluk Kahve Krema */


        /* --- CSS M√úHENDƒ∞SLƒ∞ƒûƒ∞: Geri Alƒ±nan PASTA VE MUMLAR --- */
        
        .cake-base {
            width: 300px; 
            height: 100px; 
            position: relative;
            z-index: 10;
            margin-top: 20px;
            /* Wrapper only */
        }

        @media (max-width: 640px) {
            .cake-base {
                margin-top: 20px;
                transform: scale(1.1); /* Mobilde pasta biraz daha b√ºy√ºk */
            }
        }

        /* Pasta Tabaƒüƒ± - Ayrƒ± Element */
        .plate {
            position: absolute;
            bottom: -15px;
            left: -25px;
            width: 350px;
            height: 40px;
            background: #fff;
            border-radius: 50%;
            z-index: 1; /* Pastanƒ±n altƒ±nda */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 4px solid #ddd;
        }

        /* Pasta G√∂vdesi */
        .cake-body-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 0 0 50% 50% / 0 0 20px 20px;
            z-index: 5;
            
            /* Sponge + √áikolata Par√ßacƒ±klarƒ± */
            background-color: #f3e5ab;
            background-image: 
                radial-gradient(circle, #3e2723 2px, transparent 2.5px),
                linear-gradient(to right, #f3e5ab, #e6c880, #f3e5ab);
            background-size: 25px 25px, 100% 100%;
            background-position: 0 0, 0 0;
            
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5), 
                inset 0 -10px 20px rgba(0, 0, 0, 0.1); 
        }

        /* --- √úST KREMA VE MUMLARIN YERLE≈ûƒ∞Mƒ∞ --- */
        
        /* 1. Mumlarƒ±n Oturduƒüu Beyaz Platform (Yeni Platform) */
        .cake-top-platform {
            position: absolute;
            width: 300px; 
            height: 60px;
            top: -30px;
            left: 0;
            z-index: 30; 
            
            background: #f7f7f7; /* Varsayƒ±lan, JS ile deƒüi≈üebilir */
            border-radius: 50%; 
            
            box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.1);
            
            display: flex;
            justify-content: center; 
            align-items: center;
            padding: 0 40px; 
        }
        
        /* 2. Damlayan Renkli Krema Katmanƒ± */
        .cake-top {
            width: 304px; /* Base'den biraz geni≈ü */
            height: 50px; 
            position: absolute;
            top: -32px; 
            left: -2px;
            z-index: 20; 
            
            border-radius: 50%; /* √úst√º yuvarlak */
            background: transparent;
        }
        
        /* Tema Rengi Uygulamasƒ± */
        .cake-icing-color {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            border-radius: 50%; /* √úst y√ºzey */
            opacity: 1;
            z-index: 1;
        }
        
        /* Drips */
        .cake-icing-color::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 0;
            width: 100%;
            height: 40px;
            background: inherit;
            border-radius: 20px;
            mask-image: radial-gradient(20px at 20px 0px, transparent 20px, black 21px);
            mask-size: 40px 40px;
            mask-repeat: repeat-x;
            mask-position: 0 -20px;
            -webkit-mask-image: radial-gradient(20px at 20px 0px, transparent 20px, black 21px);
            -webkit-mask-size: 40px 40px;
            -webkit-mask-repeat: repeat-x;
            -webkit-mask-position: 0 -20px;
            transform: scaleY(-1); /* Ters √ßevirip damla yap */
            opacity: 0.9;
        }


        /* Mum G√∂vdesi Stili */
        .candle-body {
            width: 16px; 
            height: 50px; /* Kƒ±saltƒ±ldƒ± */
            border-radius: 3px;
            position: relative;
            z-index: 20;

            box-shadow: 
                inset -5px 0 5px rgba(0, 0, 0, 0.1), 
                2px 2px 5px rgba(0,0,0,0.2);
            border: none; 
        }

        .candle-wrapper {
            position: relative;
            top: -15px; /* Platforma g√∂re Y pozisyonu */
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- EFECT VE Dƒ∞ƒûER STƒ∞LLER --- (Aynƒ± kaldƒ±) */

        .weather-effect-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; overflow: hidden;
        }
        
        .rain-drop {
            position: absolute; width: 2px; height: 15px; background: rgba(100, 149, 237, 0.6); 
            transform: skewX(20deg); animation-name: rain-fall-fixed; animation-timing-function: linear; animation-iteration-count: infinite;
        }
        @keyframes rain-fall-fixed {
            0% { transform: translate(0, 0) skewX(20deg); } 
            100% { transform: translate(-150vw, 150vh) skewX(20deg); }
        }

        .leaf {
            position: absolute; width: 20px; height: 20px; background: #d35400; 
            border-radius: 20px 0; opacity: 0; animation: wind-blow linear infinite;
        }
        .leaf:nth-child(2n) { background: #e67e22; width: 15px; height: 15px; }
        .leaf:nth-child(3n) { background: #c0392b; width: 25px; height: 25px; }

        @keyframes wind-blow {
            0% { transform: translate(-20vw, -10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(120vw, 40vh) rotate(720deg); opacity: 0; }
        }

        .pollen {
            position: absolute; width: 12px; height: 12px; 
            background: radial-gradient(circle, #fff 20%, #fbbf24 100%);
            border-radius: 50%; 
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.9);
            opacity: 0; 
            z-index: 100; /* G√∂r√ºn√ºrl√ºk i√ßin √∂ne alƒ±ndƒ± */
            pointer-events: none;
        }
        /* Rastgele Y√∂nler ƒ∞√ßin Animasyonlar (Daha yava≈ü ve belirgin) */
        @keyframes float-random-1 {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            10% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate(50vw, -50vh) scale(1.2); opacity: 0; }
        }
        @keyframes float-random-2 {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            10% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate(-50vw, 50vh) scale(1.2); opacity: 0; }
        }
        @keyframes float-random-3 {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            10% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate(60vw, 20vh) scale(1.2); opacity: 0; }
        }
        @keyframes float-random-4 {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            10% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate(-60vw, -20vh) scale(1.2); opacity: 0; }
        }
        
        .snowflake {
            position: absolute; 
            color: rgba(255, 255, 255, 0.9); 
            font-size: 24px; /* Kristal boyutu */
            background: transparent; 
            animation-timing-function: linear; animation-iteration-count: infinite;
            user-select: none;
        }
        .snowflake::after { content: '‚ùÑ'; }
        @keyframes fall-straight { 0% { transform: translate(0, 0); } 100% { transform: translate(0, 150vh); } }
        @keyframes fall-right { 0% { transform: translate(0, 0); } 100% { transform: translate(75vw, 150vh); } }
        @keyframes fall-left { 0% { transform: translate(0, 0); } 100% { transform: translate(-75vw, 150vh); } }


        /* Alev ve S√∂nme */
        .flame {
            width: 12px; height: 25px; background: radial-gradient(circle at 50% 10%, #fff 0%, #ffeb3b 20%, #ff9800 60%, transparent 100%);
            border-radius: 50% 50% 30% 30%; filter: drop-shadow(0 0 5px #ffcc00) drop-shadow(0 0 10px #ff9800);
            position: absolute; top: -20px; animation: flicker 0.1s infinite alternate; 
            transform-origin: bottom; transition: opacity 0.5s ease-in-out, transform 0.5s; 
            will-change: opacity, transform; cursor: pointer; 
            z-index: 31; 
        }
        .flame.off { opacity: 0 !important; transform: scale(0.5) translateY(10px); filter: none; animation: none; pointer-events: none; }
        @keyframes flicker {
            0% { transform: scaleY(1.0) translateX(0px); opacity: 1; }
            50% { transform: scaleY(0.95) translateX(0.5px); opacity: 0.95; }
            100% { transform: scaleY(1.05) translateX(-0.5px); opacity: 1; }
        }

        /* Mum Tƒ±klama ƒ∞pucu (Hover) */
        .flame:hover::after {
            content: 'üå¨Ô∏è'; /* √úfleme ƒ∞konu */
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            animation: tap-hint 0.8s ease-in-out infinite;
            pointer-events: none; /* Tƒ±klamayƒ± engellemesin */
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        @keyframes tap-hint {
            0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 0.8; }
            50% { transform: translateX(-50%) translateY(5px) scale(0.9); opacity: 1; }
            100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 0.8; }
        }

        .confetti-message { opacity: 0; transition: opacity 1s ease-in-out; }
        .confetti-message.show { opacity: 1; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 100;
        }

        /* Mobil Cihazlar ƒ∞√ßin Ek Ayarlamalar */
        @media (max-width: 640px) {
            /* Font boyutlarƒ± ve spacing'ler mobilde daha b√ºy√ºk */
            #main-greeting {
                font-size: 2rem !important;
                line-height: 1.2;
            }
            
            #age-info {
                font-size: 1.125rem !important;
            }
            
            #instruction-text {
                font-size: 1rem !important;
                padding: 12px !important;
            }
            
            #noise-label {
                font-size: 0.875rem !important;
            }
            
            #success-title {
                font-size: 1.5rem !important;
            }
            
            #success-text-name {
                font-size: 1rem !important;
            }
            
            #success-text-message {
                font-size: 0.875rem !important;
            }
            
            #reset-button {
                font-size: 0.875rem !important;
                padding: 10px 20px !important;
            }
            
            /* Ekstra k√º√ß√ºk ekranlar i√ßin */
            @media (max-height: 600px) {
                #game-container {
                    justify-content: flex-start;
                    padding-top: 15px;
                }
                
                .cake-base {
                    transform: scale(1.0);
                    margin-top: 10px;
                }
            }
        }

        /* √ñl√ßeklenebilir Oyun Konteyneri */
        #game-container {
            width: 600px;
            height: 900px;
            max-width: 100vw;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform-origin: center center;
            position: relative;
            margin: 0 auto;
            padding: 10px;
        }

        @media (max-width: 640px) {
            #game-container {
                padding: 15px;
                justify-content: flex-start;
                padding-top: 20px;
            }
        }

        /* ƒ∞lkbahar √áimen ve √ái√ßekler */
        #spring-scenery {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 150px;
            pointer-events: none; z-index: 5; display: none;
        }
        .grass {
            position: absolute; bottom: -50px; left: -10%; width: 120%; height: 150px;
            background: linear-gradient(to top, #22c55e, #4ade80); 
            border-radius: 50% 50% 0 0;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.1);
        }
        .flower {
            position: absolute; bottom: 60px;
            width: 10px; height: 10px; 
            background: #FCD34D; border-radius: 50%;
            /* Eski ≈ûekil: 4 Yaprak (Box Shadow ile) */
            box-shadow: 0 -12px 0 #F472B6, 12px 0 0 #F472B6, 0 12px 0 #F472B6, -12px 0 0 #F472B6;
            transform-origin: bottom center;
            animation: sway 3s ease-in-out infinite alternate;
        }
        /* √ái√ßek √áe≈üitliliƒüi (Renkler ve Konumlar Korundu, ≈ûekil Eskiye D√∂nd√º) */
        .flower:nth-child(2n) { 
            box-shadow: 0 -12px 0 #A78BFA, 12px 0 0 #A78BFA, 0 12px 0 #A78BFA, -12px 0 0 #A78BFA; 
            animation-delay: 0.5s; 
        }
        .flower:nth-child(3n) { 
            bottom: 70px; 
            box-shadow: 0 -12px 0 #F87171, 12px 0 0 #F87171, 0 12px 0 #F87171, -12px 0 0 #F87171; 
            animation-delay: 1s; 
        }
        .flower:nth-child(4n) { 
            bottom: 50px; 
            box-shadow: 0 -12px 0 #60A5FA, 12px 0 0 #60A5FA, 0 12px 0 #60A5FA, -12px 0 0 #60A5FA; 
            animation-delay: 1.5s; 
        }
        .flower:nth-child(5n) { 
            bottom: 80px; 
            box-shadow: 0 -12px 0 #F472B6, 12px 0 0 #F472B6, 0 12px 0 #F472B6, -12px 0 0 #F472B6; 
            animation-delay: 0.2s; 
        }

        @keyframes sway {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }

        /* Plaj Topu */
        .beach-ball {
            position: fixed;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            /* Klasik Plaj Topu Renkleri */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 5%, transparent 15%),
                        conic-gradient(
                            #ef4444 0deg 60deg,    /* Kƒ±rmƒ±zƒ± */
                            #fbbf24 60deg 120deg,  /* Sarƒ± */
                            #3b82f6 120deg 180deg, /* Mavi */
                            #ef4444 180deg 240deg, 
                            #fbbf24 240deg 300deg, 
                            #3b82f6 300deg 360deg
                        );
            box-shadow: inset -15px -15px 30px rgba(0,0,0,0.2), 10px 20px 30px rgba(0,0,0,0.3);
            z-index: 200;
            cursor: grab;
            display: none;
            touch-action: none;
            user-select: none;
        }
        .beach-ball:active { cursor: grabbing; }
        /* Topun ortasƒ±ndaki beyaz daire */
        .beach-ball::after {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto;
            width: 20px; height: 20px; background: white; border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="theme-winter">

    <!-- Hava Durumu Efekti Konteynerleri -->
    <div id="weather-container">
        <div id="snow-container" class="weather-effect-container"></div>
        <div id="rain-container" class="weather-effect-container"></div>
        <div id="pollen-container" class="weather-effect-container"></div>
    </div>

    <!-- ƒ∞lkbahar Manzarasƒ± -->
    <div id="spring-scenery">
        <div class="grass"></div>
        <!-- √ái√ßekler (3 Katƒ±na √áƒ±karƒ±ldƒ±) -->
        <div class="flower" style="left: 5%; bottom: 75px;"></div>
        <div class="flower" style="left: 10%; bottom: 85px;"></div>
        <div class="flower" style="left: 15%; bottom: 65px;"></div>
        <div class="flower" style="left: 20%; bottom: 90px; transform: scale(0.8);"></div>
        <div class="flower" style="left: 25%; bottom: 70px;"></div>
        <div class="flower" style="left: 35%; bottom: 80px;"></div>
        <div class="flower" style="left: 45%; bottom: 60px;"></div>
        <div class="flower" style="left: 50%; bottom: 60px; transform: scale(0.9);"></div>
        <div class="flower" style="left: 60%; bottom: 85px;"></div>
        <div class="flower" style="left: 70%; bottom: 75px;"></div>
        <div class="flower" style="left: 80%; bottom: 70px; transform: scale(1.1);"></div>
        <div class="flower" style="left: 90%; bottom: 80px;"></div>
    </div>

    <!-- Plaj Topu -->
    <div id="beach-ball" class="beach-ball"></div>

    <!-- ƒ∞sim Giri≈üi Modal (KALDIRILDI) -->
    <!-- 
    <div id="name-modal" class="modal-overlay"> ... </div> 
    -->

    <!-- Ana Uygulama ƒ∞√ßeriƒüi -->
    <div id="game-container" class="relative z-40">
        
        <!-- √úst Kontrol Paneli -->
        <div class="flex space-x-3 md:space-x-4 mb-4 md:mb-4 z-50">
            <!-- Dil Deƒüi≈ütirme Butonu -->
            <button id="lang-toggle" 
                    class="p-2 md:p-2 bg-white text-red-600 rounded-full text-sm md:text-sm font-semibold shadow-lg hover:bg-gray-100 transition">
                English
            </button>
            
            <!-- Tema Se√ßim Kutusu (KALDIRILDI - Otomatik Tarih Bazlƒ±) -->
        </div>

        <!-- Ba≈ülƒ±k Mesajƒ± -->
        <div class="bg-white p-4 md:p-4 rounded-xl shadow-xl text-center mb-6 md:mb-6 border-4 border-red-600">
            <h1 id="main-greeting" class="text-4xl md:text-4xl lg:text-6xl font-extrabold text-green-700 mb-2 md:mb-2">
                ƒ∞Yƒ∞ Kƒ∞ DOƒûDUN!
            </h1>
            <p id="age-info" class="text-lg md:text-xl text-red-600 font-bold"></p>
        </div>

        <p id="instruction-text" class="text-lg md:text-xl text-white mb-6 md:mb-8 text-center font-semibold bg-red-600 p-3 md:p-2 rounded-lg shadow-md">
            Mumlarƒ± √ºfleyin VEYA √ºzerine dokunun!
        </p>

        <!-- Pasta ve Mum Alanƒ± -->
        <div class="cake-base relative">
            
            <!-- Tabak (En altta) -->
            <div class="plate"></div>

            <!-- Pasta G√∂vdesi (√áikolata Par√ßacƒ±klƒ±) -->
            <div class="cake-body-layer"></div>

            <!-- Mumlarƒ±n Oturduƒüu Platform -->
            <div class="cake-top-platform">
                <div id="candles-container" class="flex justify-center w-full h-full items-end">
                    <!-- Mumlar JavaScript ile buraya eklenecek -->
                </div>
            </div>

            <!-- Krema D√∂k√ºlme Katmanƒ± -->
            <div class="cake-top">
                 <!-- Tema rengi bu div'e uygulanƒ±r -->
                <div class="cake-icing-color"></div>
            </div>
        </div>

        <!-- Mikrofon G√ºr√ºlt√º Seviyesi G√∂stergesi -->
        <div class="w-full max-w-sm mt-6 md:mt-10 px-4">
            <div id="noise-label" class="text-center text-white mb-2 md:mb-2 font-bold text-base md:text-base">G√ºr√ºlt√º Seviyesi (E≈üik: 10):</div>
            <div class="bg-gray-700 h-6 md:h-6 rounded-full overflow-hidden shadow-inner border border-gray-500">
                <div id="noise-level-bar" class="h-full bg-green-500 transition-all duration-100 ease-linear" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Ba≈üarƒ± Mesajƒ± -->
        <div id="success-message" class="confetti-message mt-6 md:mt-12 p-4 md:p-5 bg-white rounded-lg shadow-2xl border-4 border-green-700 max-w-lg mx-auto text-center z-40">
            <h2 id="success-title" class="text-2xl md:text-3xl font-bold text-red-700">MUMLAR S√ñND√ú! üéâ</h2>
            <p id="success-text-name" class="text-base md:text-lg font-semibold text-green-800 mt-2 md:mt-2"></p>
            <p id="success-text-message" class="text-sm md:text-md text-gray-700 italic mt-2 mb-3 md:mb-4"></p>
            <button id="reset-button" class="py-2 md:py-2 px-4 md:px-6 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition shadow-md text-sm md:text-base">
                Mumlarƒ± Tekrar Yak / Yeniden Ba≈ülat
            </button>
        </div>
    </div>

    <script>
        // --- Sabitler ve Ayarlar ---
        const NUM_CANDLES = 4;
        const BLOW_THRESHOLD = 25; 
        const CURRENT_YEAR = new Date().getFullYear();
        const WINTER_SNOW_COUNT = 180; 
        const RAIN_SPAWN_INTERVAL = 8000; 
        const RAIN_BATCH_SIZE = 80; 
        const SNOW_FALL_DURATION = 15; 
        const SPRING_POLLEN_COUNT = 270; // Polen miktarƒ± 3 katƒ±na √ßƒ±karƒ±ldƒ± (90)
        
        let currentLang = 'tr';
        let currentTheme = 'winter';
        // Hardcoded Bilgiler
        let personName = 'Hƒ±rnat';
        let birthYear = 1999; 
        let customMessage = 'Mutlu yƒ±llar, sevgili Hƒ±rnat! ƒ∞yi ki doƒüdun!'; 
        let allCandlesOut = false;
        
        let audioContext, analyser, microphone, dataArray;
        let candleFlames = [];
        let loop;
        let candlesOutCount = 0;
        let rainSpawnInterval; 

        // Plaj Topu Deƒüi≈ükenleri
        const beachBall = document.getElementById('beach-ball');
        let ballX = 100, ballY = 100;
        let ballVX = 3, ballVY = 3;
        let ballAnimationId;
        let ballDirection = 1;
        let isBallWaiting = false;

        // Kar taneleri i√ßin basit y√∂nler
        const snowAnglesMap = [
            { animation: 'fall-straight' },
            { animation: 'fall-right' },
            { animation: 'fall-left' }
        ];

        // Polenler i√ßin rastgele y√∂nler
        const pollenAnglesMap = [
            { animation: 'float-random-1' },
            { animation: 'float-random-2' },
            { animation: 'float-random-3' },
            { animation: 'float-random-4' }
        ];

        // Yaƒümur i√ßin sabit y√∂n
        const rainFixedAngle = { animation: 'rain-fall-fixed' };

        // --- √áeviriler (Aynƒ±) ---
        const translations = {
            tr: {
                pageTitle: "ƒ∞yi ki Doƒüdun",
                modalTitle: "Ki≈üisel Bilgileri Girin",
                modalNamePlaceholder: "Doƒüum G√ºn√º Sahibi Adƒ± (√ñrn: Ay≈üe)",
                modalYearPlaceholder: "Doƒüum Yƒ±lƒ± (√ñrn: 1980)",
                modalMessagePlaceholder: "√ñzel Doƒüum G√ºn√º Mesajƒ± (√ñrn: Nice mutlu ya≈ülara!)",
                modalButton: "Ba≈ülat",
                mainGreeting: "ƒ∞Yƒ∞ Kƒ∞ DOƒûDUN {NAME}!",
                ageInfo: "{AGE} Ya≈üƒ±n Kutlu Olsun!",
                instruction: "Mumlarƒ± √ºfleyin VEYA √ºzerine dokunun!",
                noiseLabel: "G√ºr√ºlt√º Seviyesi (E≈üik: 25):",
                successTitle: "MUMLAR S√ñND√ú! üéâ",
                successTextName: "Mutlu yƒ±llar, sevgili {NAME}.",
                successTextMessage: "{MESSAGE}",
                resetButton: "Mumlarƒ± Tekrar Yak / Yeniden Ba≈ülat",
                langToggle: "English",
                optWinter: "Kƒ±≈ü (Karlƒ±)",
                optSpring: "ƒ∞lkbahar (Polen)",
                optSummer: "Yaz (Plaj)",
                optAutumn: "Sonbahar (Yaƒümur)"
            },
            en: {
                pageTitle: "Happy Birthday",
                modalTitle: "Enter Personal Details",
                modalNamePlaceholder: "Birthday Person's Name (E.g: John)",
                modalYearPlaceholder: "Birth Year (E.g: 1980)",
                modalMessagePlaceholder: "Special Birthday Message (E.g: Wish you all the best!)",
                modalButton: "Start",
                mainGreeting: "HAPPY BIRTHDAY {NAME}!",
                ageInfo: "Celebrating {AGE} Years!",
                instruction: "Blow out the candles OR tap on them!",
                noiseLabel: "Noise Level (Threshold: 25):",
                successTitle: "CANDLES BLOWN OUT! üéâ",
                successTextName: "Happy birthday, dear {NAME}.",
                successTextMessage: "{MESSAGE}",
                resetButton: "Relight Candles / Restart",
                langToggle: "T√ºrk√ße",
                optWinter: "Winter (Snowy)",
                optSpring: "Spring (Pollen)",
                optSummer: "Summer (Beach)",
                optAutumn: "Autumn (Rainy)"
            }
        };

        // --- DOM Elementleri ---
        const pageTitle = document.getElementById('page-title');
        const modalTitle = document.getElementById('modal-title');
        const modalNameInput = document.getElementById('person-name-input');
        const modalYearInput = document.getElementById('birth-year-input');
        const modalMessageInput = document.getElementById('message-input');
        const modalButton = document.getElementById('modal-button');
        const langToggle = document.getElementById('lang-toggle');
        // const themeSelector = document.getElementById('theme-selector'); // KALDIRILDI
        const mainGreeting = document.getElementById('main-greeting');
        const ageInfo = document.getElementById('age-info');
        const instructionText = document.getElementById('instruction-text');
        const noiseLabel = document.getElementById('noise-label');
        const noiseLevelBar = document.getElementById('noise-level-bar');
        const successTitle = document.getElementById('success-title');
        const successTextName = document.getElementById('success-text-name');
        const successTextMessage = document.getElementById('success-text-message');
        const resetButton = document.getElementById('reset-button');
        const candlesContainer = document.getElementById('candles-container');
        const successMessage = document.getElementById('success-message');
        const nameModal = document.getElementById('name-modal');
        const nameForm = document.getElementById('name-form');
        const snowContainer = document.getElementById('snow-container');
        const rainContainer = document.getElementById('rain-container');
        const pollenContainer = document.getElementById('pollen-container');


        // --- Fonksiyonlar ---

        /**
         * Aray√ºzdeki t√ºm metinleri se√ßili dile ve girilen bilgilere g√∂re g√ºnceller.
         */
        function updateText(lang) {
            const t = translations[lang];
            
            const age = CURRENT_YEAR - birthYear;
            const ageDisplay = isNaN(age) || age < 0 ? '?' : age;
            
            // Modal elementleri kaldƒ±rƒ±ldƒ±ƒüƒ± i√ßin bu satƒ±rlar iptal edildi
            // modalTitle.textContent = t.modalTitle;
            // modalNameInput.placeholder = t.modalNamePlaceholder;
            // modalYearInput.placeholder = t.modalYearPlaceholder;
            // modalMessageInput.placeholder = t.modalMessagePlaceholder;
            // modalButton.textContent = t.modalButton;

            pageTitle.textContent = t.pageTitle;
            langToggle.textContent = t.langToggle;
            mainGreeting.textContent = t.mainGreeting.replace("{NAME}", personName);
            ageInfo.textContent = t.ageInfo.replace("{AGE}", ageDisplay);
            instructionText.textContent = t.instruction;
            noiseLabel.textContent = t.noiseLabel;
            resetButton.textContent = t.resetButton;

            // Tema se√ßenekleri kaldƒ±rƒ±ldƒ±ƒüƒ± i√ßin bu satƒ±rlar iptal edildi
            // document.getElementById('opt-winter').textContent = t.optWinter;
            // document.getElementById('opt-spring').textContent = t.optSpring;
            // document.getElementById('opt-summer').textContent = t.optSummer;
            // document.getElementById('opt-autumn').textContent = t.optAutumn;

            successTitle.textContent = t.successTitle;
            successTextName.textContent = t.successTextName.replace("{NAME}", personName);
            successTextMessage.textContent = t.successTextMessage.replace("{MESSAGE}", customMessage);
            
            // themeSelector.value = currentTheme; // KALDIRILDI
        }
        
        /**
         * Mevsimi g√ºn√ºn tarihine g√∂re belirler.
         */
        function getInitialTheme() {
            const month = new Date().getMonth() + 1; 
            
            if (month >= 3 && month <= 5) return 'spring'; 
            if (month >= 6 && month <= 8) return 'summer'; 
            if (month >= 9 && month <= 11) return 'autumn'; 
            return 'winter'; 
        }

        /**
         * Hava durumu efektlerini temizler ve se√ßilen temaya uygun olanƒ± ba≈ülatƒ±r.
         */
        function applyTheme(theme) {
            document.body.className = '';
            document.body.classList.add(`theme-${theme}`);
            currentTheme = theme;
            // themeSelector.value = theme; // KALDIRILDI

            // T√ºm interval'i durdur
            if (rainSpawnInterval) {
                clearTimeout(rainSpawnInterval);
            }

            // Konteynerleri temizle
            snowContainer.style.display = 'none';
            rainContainer.style.display = 'none';
            pollenContainer.style.display = 'none';
            document.getElementById('spring-scenery').style.display = 'none';
            beachBall.style.display = 'none'; // Topu gizle
            if(ballAnimationId) cancelAnimationFrame(ballAnimationId);

            rainContainer.innerHTML = ''; 
            pollenContainer.innerHTML = ''; 
            snowContainer.innerHTML = ''; 
            
            // Tema efektlerini uygula
            if (theme === 'winter') {
                snowContainer.style.display = 'block';
                // Kar (Tipi/Rastgele Y√∂n, Sabit Hƒ±z)
                createParticleEffect(snowContainer, WINTER_SNOW_COUNT, 'snowflake', 20, true, true); 
            } else if (theme === 'spring') {
                pollenContainer.style.display = 'block'; // Yaƒümur yerine polen
                document.getElementById('spring-scenery').style.display = 'block'; // G√∂ster
                // Polen (Rastgele Y√∂n)
                createParticleEffect(pollenContainer, SPRING_POLLEN_COUNT, 'pollen', 15, true, true); 
            } else if (theme === 'summer') {
                beachBall.style.display = 'block';
                initBeachBall();
            } else if (theme === 'autumn') {
                pollenContainer.style.display = 'block';
                // R√ºzgar (Sonbahar Yapraklarƒ±)
                createParticleEffect(pollenContainer, 400, 'leaf', 10, false, false); 
            }
        }
        
        /**
         * Plaj Topu Mantƒ±ƒüƒ±
         */
        function initBeachBall() {
            isBallWaiting = false;
            // ƒ∞lk ba≈ülangƒ±√ß: Soldan girsin
            resetBallPosition(true);
            updateBall();
        }

        function resetBallPosition(fromLeft) {
            const ballSize = 120;
            // Ba≈ülangƒ±√ß Y konumu: Ekranƒ±n alt yarƒ±sƒ±ndan fƒ±rlatƒ±lsƒ±n
            ballY = window.innerHeight - 150 - Math.random() * 200; 

            if (fromLeft) {
                ballX = -ballSize - 10;
                ballDirection = 1;
                // Saƒüa doƒüru fƒ±rlat
                ballVX = 10 + Math.random() * 5; 
            } else {
                ballX = window.innerWidth + 10;
                ballDirection = -1;
                // Sola doƒüru fƒ±rlat
                ballVX = -(10 + Math.random() * 5);
            }
            
            // Yukarƒ± doƒüru fƒ±rlatma hƒ±zƒ± (Negatif Y yukarƒ±dƒ±r)
            ballVY = -(15 + Math.random() * 10); 
        }

        function updateBall() {
            if (currentTheme !== 'summer') return;

            if (!isBallWaiting) {
                // Fizik (Eƒüik Atƒ±≈ü)
                ballX += ballVX;
                ballY += ballVY;
                
                // Yer√ßekimi
                ballVY += 0.5;

                // Sƒ±nƒ±r Kontrol√º (Ekranƒ±n altƒ±na d√º≈üt√ºyse veya yanlardan √ßok uzakla≈ütƒ±ysa)
                const ballSize = 120;
                const isOffScreenBottom = ballY > window.innerHeight + ballSize;
                const isOffScreenRight = ballX > window.innerWidth + ballSize;
                const isOffScreenLeft = ballX < -ballSize * 2;

                if (isOffScreenBottom || isOffScreenRight || isOffScreenLeft) {
                    isBallWaiting = true;
                    // Bir sonraki atƒ±≈ü ters y√∂nden olsun
                    const nextFromLeft = (ballDirection === -1); 
                    setTimeout(() => { 
                        resetBallPosition(nextFromLeft); 
                        isBallWaiting = false; 
                    }, 1000);
                }
            }
            
            beachBall.style.transform = `translate(${ballX}px, ${ballY}px) rotate(${ballX * 2}deg)`;
            
            ballAnimationId = requestAnimationFrame(updateBall);
        }

        /**
         * Kar veya Polen efektlerini olu≈üturan jenerik fonksiyon.
         */
        function createParticleEffect(container, num, className, maxDelay, isWideStart, isRandomAngle) {
            for (let i = 0; i < num; i++) {
                const particle = document.createElement('div');
                particle.className = className;
                
                // Geni≈ületilmi≈ü ba≈ülangƒ±√ß alanƒ±
                particle.style.left = `${-150 + Math.random() * 250}vw`; 
                particle.style.top = `${-150 + Math.random() * 150}vh`; 
                
                // Rastgele gecikme
                particle.style.animationDelay = `${Math.random() * maxDelay}s`;
                
                if (className === 'snowflake') {
                    // Kar: Sabit d√º≈üme hƒ±zƒ±, rastgele y√∂n
                    particle.style.animationDuration = `${SNOW_FALL_DURATION}s`;
                    
                    if (isRandomAngle) {
                        const randomAngle = snowAnglesMap[Math.floor(Math.random() * snowAnglesMap.length)];
                        particle.style.animationName = randomAngle.animation;
                    }
                } else if (className === 'pollen') {
                    // Polen: Sabit y√∂n, rastgele hƒ±z
                    particle.style.animationDuration = `${10 + Math.random() * 10}s`;
                    
                    if (isRandomAngle) {
                        const randomAngle = pollenAnglesMap[Math.floor(Math.random() * pollenAnglesMap.length)];
                        particle.style.animationName = randomAngle.animation;
                    }
                } else if (className === 'leaf') {
                    // Yaprak: R√ºzgar efekti
                    particle.style.animationDuration = `${5 + Math.random() * 5}s`;
                }
                container.appendChild(particle);
            }
        }           
        
        /**
         * Yaƒümur efektini olu≈üturan fonksiyon. (Sabit saƒü √ßapraz y√∂n)
         */
        function createRainEffect(container, num) {
             for (let i = 0; i < num; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                
                // Animasyon sabit yaƒümur y√∂n√ºne ayarlandƒ±
                drop.style.animationName = rainFixedAngle.animation;

                // Geni≈ületilmi≈ü ba≈ülangƒ±√ß alanƒ±
                drop.style.left = `${-150 + Math.random() * 250}vw`; 
                drop.style.top = `-${Math.random() * 150}vh`; 

                // Rastgele hƒ±z
                drop.style.animationDuration = `${0.5 + Math.random() * 0.5}s`;
                drop.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(drop);
            }
            // S√ºreklilik i√ßin (Azaltƒ±lmƒ±≈ü sƒ±klƒ±k)
            rainSpawnInterval = setTimeout(() => createRainEffect(container, num), RAIN_SPAWN_INTERVAL);
        }


        /**
         * Arka plan m√ºziƒüini Tone.js kullanarak ba≈ülatƒ±r.
         */
        function startMusic() {
            // √ñnceki m√ºziƒüi temizle ve durdur
            Tone.Transport.stop();
            Tone.Transport.cancel();

            const synth = new Tone.Synth().toDestination();
            
            // Happy Birthday Melodisi (Zamanlama: Bar:Beat:Sixteenth)
            const melody = [
                { time: "0:0:0", note: "G4", duration: "8n" },
                { time: "0:0:2", note: "G4", duration: "8n" },
                { time: "0:1:0", note: "A4", duration: "4n" },
                { time: "0:2:0", note: "G4", duration: "4n" },
                { time: "0:3:0", note: "C5", duration: "4n" },
                { time: "1:0:0", note: "B4", duration: "2n" },
                
                { time: "1:2:0", note: "G4", duration: "8n" },
                { time: "1:2:2", note: "G4", duration: "8n" },
                { time: "1:3:0", note: "A4", duration: "4n" },
                { time: "2:0:0", note: "G4", duration: "4n" },
                { time: "2:1:0", note: "D5", duration: "4n" },
                { time: "2:2:0", note: "C5", duration: "2n" },
                
                { time: "3:0:0", note: "G4", duration: "8n" },
                { time: "3:0:2", note: "G4", duration: "8n" },
                { time: "3:1:0", note: "G5", duration: "4n" },
                { time: "3:2:0", note: "E5", duration: "4n" },
                { time: "3:3:0", note: "C5", duration: "4n" },
                { time: "4:0:0", note: "B4", duration: "4n" },
                { time: "4:1:0", note: "A4", duration: "4n" },
                
                { time: "4:3:0", note: "F5", duration: "8n" },
                { time: "4:3:2", note: "F5", duration: "8n" },
                { time: "5:0:0", note: "E5", duration: "4n" },
                { time: "5:1:0", note: "C5", duration: "4n" },
                { time: "5:2:0", note: "D5", duration: "4n" },
                { time: "5:3:0", note: "C5", duration: "2n" }
            ];

            const part = new Tone.Part((time, value) => {
                synth.triggerAttackRelease(value.note, value.duration, time);
            }, melody);

            part.loop = true;
            part.loopEnd = "6:0:0"; 
            
            part.start(0);
            Tone.Transport.start();
        }

        /**
         * Mumlarƒ± HTML i√ßine dinamik olarak yerle≈ütirir ve alev dizisini doldurur.
         */
        function setupCandles() {
            candlesContainer.innerHTML = ''; 
            candleFlames = []; 
            candlesOutCount = 0; 

            for (let i = 0; i < NUM_CANDLES; i++) {
                const candleWrapper = document.createElement('div');
                candleWrapper.className = 'candle-wrapper';

                const wick = document.createElement('div');
                wick.className = 'candle-wick';

                const flame = document.createElement('div');
                flame.className = 'flame';
                flame.id = `flame-${i}`;
                
                // Dokunmatik s√∂nd√ºrme i≈ülevi
                flame.onclick = (e) => {
                    e.stopPropagation(); 
                    blowOutSingleCandle(flame);
                };

                candleFlames.push(flame); 

                const body = document.createElement('div');
                body.className = 'candle-body relative';
                
                body.appendChild(wick);
                candleWrapper.appendChild(flame);
                candleWrapper.appendChild(body);
                candlesContainer.appendChild(candleWrapper);
            }
        }
        
        /**
         * Tek bir mumu s√∂nd√ºr√ºr ve toplam s√∂nen mum sayƒ±sƒ±nƒ± kontrol eder.
         */
        function blowOutSingleCandle(flameElement) {
            if (flameElement.classList.contains('off')) return; 

            flameElement.classList.add('off');
            candlesOutCount++;

            if (candlesOutCount === NUM_CANDLES) {
                blowOutAllCandles(); 
            }
        }

        /**
         * Mikrofon eri≈üimini ve ses analizini ba≈ülatƒ±r.
         */
        async function setupAudio() {
            if (audioContext && microphone) {
                startMusic();
                analyseSound();
                return;
            }

            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                startMusic(); 

                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 2048;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                
                microphone.connect(analyser);

                instructionText.textContent = translations[currentLang].instruction;
                analyseSound();

            } catch (err) {
                const errorMessage = currentLang === 'tr' ? 
                    "HATA: Mikrofon eri≈üimi reddedildi. Mumlarƒ± √ºflemek i√ßin izin verin." : 
                    "ERROR: Microphone access denied. Please allow to blow out the candles.";
                instructionText.textContent = errorMessage;
                noiseLabel.parentElement.style.display = 'none';
                console.error('Mikrofon eri≈üiminde hata:', err);
            }
        }

        /**
         * Ses seviyesini s√ºrekli analiz eden d√∂ng√º.
         */
        function analyseSound() {
            if (allCandlesOut) {
                return;
            }

            analyser.getByteFrequencyData(dataArray);

            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = (sum / dataArray.length);

            const noiseLevel = Math.min(100, Math.round((average / 1.8) * (100 / 100))); 
            
            updateNoiseBar(noiseLevel);

            if (noiseLevel > BLOW_THRESHOLD) {
                candleFlames.forEach(flame => {
                    blowOutSingleCandle(flame);
                });
            }

            requestAnimationFrame(analyseSound);
        }

        /**
         * G√ºr√ºlt√º √ßubuƒüunun geni≈üliƒüini g√ºnceller.
         */
        function updateNoiseBar(level) {
            const barWidth = Math.min(100, level * (100 / BLOW_THRESHOLD)); 
            
            noiseLevelBar.style.width = `${barWidth}%`;
            
            if (level >= BLOW_THRESHOLD) {
                noiseLevelBar.classList.remove('bg-green-500');
                noiseLevelBar.classList.add('bg-red-500');
            } else {
                noiseLevelBar.classList.remove('bg-red-500');
                noiseLevelBar.classList.add('bg-green-500');
            }
        }

        /**
         * T√ºm mumlar s√∂nd√ºƒü√ºnde tetiklenir.
         */
        function blowOutAllCandles() {
            if (allCandlesOut) return;

            if (Tone.Transport.state === 'started') {
                Tone.Transport.stop();
            }

            allCandlesOut = true;
            
            instructionText.textContent = translations[currentLang].successTitle; 
            
            setTimeout(() => {
                successMessage.classList.add('show');
            }, 500); 
        }

        /**
         * Uygulamayƒ± ba≈ülangƒ±√ß durumuna d√∂nd√ºr√ºr.
         */
        function resetApp() {
            allCandlesOut = false;
            candlesOutCount = 0;
            
            candleFlames.forEach(flame => {
                flame.classList.remove('off');
            });

            successMessage.classList.remove('show');
            instructionText.textContent = translations[currentLang].instruction;
            
            applyTheme(currentTheme); 

            startMusic(); 
            analyseSound(); 
            updateNoiseBar(0); 
        }


        // --- Olay Dinleyicileri ---

        // 1. ƒ∞sim/Yƒ±l/Mesaj Formu G√∂nderme (ƒ∞PTAL EDƒ∞LDƒ∞)
        /*
        nameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            nameModal.classList.add('hidden');
            updateText(currentLang);
            setupAudio(); 
        });
        */

        // 2. Dil Deƒüi≈ütirme Butonu
        langToggle.addEventListener('click', () => {
            currentLang = currentLang === 'tr' ? 'en' : 'tr';
            updateText(currentLang);
        });
        
        // 3. Tema Se√ßici (KALDIRILDI)
        /*
        themeSelector.addEventListener('change', (e) => {
            applyTheme(e.target.value);
        });
        */

        // 4. Sƒ±fƒ±rlama Butonu
        resetButton.addEventListener('click', resetApp);


        // --- Uygulama Ba≈ülatma ---
        window.onload = () => {
            setupCandles(); 
            const initialTheme = getInitialTheme();
            applyTheme(initialTheme); 
            updateText('tr'); 
            successMessage.classList.remove('show'); 
            
            // ƒ∞lk boyutlandƒ±rma i√ßin kƒ±sa gecikme (t√ºm elementler y√ºklensin)
            setTimeout(() => {
                resizeGame();
            }, 100);
            
            // M√ºzik ve Ses Analizini Ba≈ülat (Otomatik)
            // Not: Tarayƒ±cƒ± politikalarƒ± gereƒüi kullanƒ±cƒ± etkile≈üimi gerekebilir.
            // Ancak kullanƒ±cƒ± sayfaya tƒ±kladƒ±ƒüƒ±nda veya mumlara dokunduƒüunda zaten √ßalƒ±≈üacaktƒ±r.
            setupAudio().catch(e => console.log("Otomatik ses ba≈ülatma engellendi, kullanƒ±cƒ± etkile≈üimi bekleniyor.", e));
            
            // Sayfaya ilk tƒ±klamada sesi garantiye al
            document.body.addEventListener('click', function initAudio() {
                setupAudio();
                document.body.removeEventListener('click', initAudio);
            }, { once: true });
        };

        // --- Ekran Boyutlandƒ±rma (Responsive Scaling) ---
        function resizeGame() {
            const container = document.getElementById('game-container');
            if (!container) return;
            
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const isMobile = windowWidth <= 640;
            
            if (isMobile) {
                // Mobilde scale kullanma, doƒürudan responsive CSS kullan
                container.style.transform = 'none';
                container.style.width = '100%';
                container.style.height = 'auto';
                container.style.maxHeight = '100vh';
            } else {
                // Desktop'ta scale kullan
                // Tasarƒ±mƒ±n baz alƒ±ndƒ±ƒüƒ± √ß√∂z√ºn√ºrl√ºk (Geni≈ülik x Y√ºkseklik)
                const baseWidth = 600;
                const baseHeight = 900;
                
                // Body padding'i hesaba kat
                const bodyPadding = 20;
                const availableWidth = windowWidth - bodyPadding;
                const availableHeight = windowHeight - bodyPadding;
                
                // Hem geni≈ülik hem y√ºksekliƒüe g√∂re sƒ±ƒüdƒ±rma oranƒ± hesapla
                const scaleX = availableWidth / baseWidth;
                const scaleY = availableHeight / baseHeight;
                
                // En k√º√ß√ºk oranƒ± se√ßerek ekrana sƒ±ƒümasƒ±nƒ± saƒüla (Aspect Ratio korunur)
                const scale = Math.min(scaleX, scaleY) * 0.98; 
                
                container.style.transform = `scale(${scale})`;
                container.style.transformOrigin = 'center center';
                container.style.width = '600px';
                container.style.height = '900px';
            }
        }

        // Resize event listener
        window.addEventListener('resize', resizeGame);
        
        // Orientation change i√ßin de resize yap
        window.addEventListener('orientationchange', () => {
            setTimeout(resizeGame, 100);
        });
    </script>
</body>
</html>
